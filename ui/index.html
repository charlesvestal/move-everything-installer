<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move Everything Installer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Warning Screen -->
        <div id="screen-warning" class="screen active">
            <h1 id="warning-title">Move Everything Installer</h1>
            <div class="warning-box" id="warning-box">
                <p><strong>Are you sure you want to install Move Everything on your Ableton Move?</strong></p>
                <p>This software is <strong>community-developed</strong> and not officially supported by Ableton.</p>
                <p>The installation is designed to be safe and reversible. The authors accept no liability for issues, but countless users have installed Move Everything with no reports of permanent damage or bricking a device.</p>
                <p><strong>Note:</strong> Installation works best when your Move is connected via <strong>WiFi</strong>, not USB-C. Ensure your Move is connected to the same network as this computer.</p>
            </div>
            <div class="action-buttons">
                <button id="btn-cancel" class="secondary">Cancel</button>
                <button id="btn-accept-warning">Continue</button>
            </div>
        </div>

        <!-- Device Discovery Screen -->
        <div id="screen-discovery" class="screen">
            <h1>Move Everything Installer</h1>
            <div class="hostname-entry">
                <label for="device-hostname">Device hostname:</label>
                <input type="text" id="device-hostname" value="move.local">
            </div>
            <div id="discovery-status">
                <div class="spinner"></div>
                <p id="status-text">Searching for your Ableton Move...</p>
            </div>
            <div id="device-list"></div>
            <div class="manual-entry" style="display: none;">
                <p>Can't find your device? Enter IP address:</p>
                <input type="text" id="manual-ip" placeholder="e.g., 192.168.1.100">
                <button id="btn-manual-connect">Connect</button>
            </div>
            <button id="btn-cancel-discovery" class="secondary">Back</button>
        </div>

        <!-- Code Entry Screen -->
        <div id="screen-code-entry" class="screen">
            <h1>Enter Authorization Code</h1>
            <p class="instruction">Check your Ableton Move display for a 6-digit code</p>
            <div class="code-input">
                <input type="text" id="code-digit-1" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-2" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-3" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-4" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-5" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-6" maxlength="1" class="code-digit">
            </div>
            <button id="btn-submit-code" disabled>Continue</button>
            <button id="btn-back-discovery" class="secondary">Back</button>
        </div>

        <!-- SSH Key Setup Screen -->
        <div id="screen-ssh-key" class="screen">
            <h1>Secure Connection Setup</h1>
            <p class="instruction" id="ssh-key-message"></p>
            <div class="info-box" id="ssh-key-explanation" style="display: none;">
                <p><strong>What is this?</strong></p>
                <p>A secure connection key lets the installer communicate safely with your Move device. This key will only be used for Move Everything installation and won't affect other systems.</p>
            </div>
            <div class="action-buttons">
                <button id="btn-back-ssh-key" class="secondary">Back</button>
                <button id="btn-add-ssh-key">Add Key to Move</button>
            </div>
        </div>

        <!-- Confirm on Device Screen -->
        <div id="screen-confirm" class="screen">
            <h1>Confirm on Device</h1>
            <div class="spinner"></div>
            <p class="instruction">On your Ableton Move, use the jog wheel to select "Yes" and press to confirm</p>
            <p class="instruction" style="font-size: 0.9rem; margin-top: 1rem;">Waiting for confirmation...</p>
            <button id="btn-cancel-confirm" class="secondary">Cancel</button>
        </div>

        <!-- Loading Screen (used for version checks and other loading states) -->
        <div id="screen-version-check" class="screen">
            <h1>Please Wait</h1>
            <div id="version-check-status">
                <div class="spinner"></div>
                <p class="instruction">Loading...</p>
            </div>
        </div>

        <!-- Module Selection Screen -->
        <div id="screen-modules" class="screen">
            <h1>Installation Options</h1>

            <div class="install-options">
                <h3>Installation Type</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="complete" checked>
                        <div class="option-content">
                            <strong>Complete</strong>
                            <span>All modules with full UI (recommended)</span>
                            <p class="option-detail">Installs Signal Chain, synths, effects, and all UI features. Best for most users.</p>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="custom">
                        <div class="option-content">
                            <strong>Custom</strong>
                            <span>Choose specific modules</span>
                            <p class="option-detail">Select only the modules you want. Saves space if you don't need everything.</p>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="core">
                        <div class="option-content">
                            <strong>Core Only</strong>
                            <span>Framework and UI, no modules</span>
                            <p class="option-detail">Minimal installation. Add modules later via Module Store. Good for testing.</p>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="install-type" value="screenreader">
                        <div class="option-content">
                            <strong>Screen Reader Only</strong>
                            <span>Audio interface with text-to-speech</span>
                            <p class="option-detail">For visually impaired users. No visual display. All navigation via voice prompts.</p>
                        </div>
                    </label>
                </div>

                <h3>Accessibility</h3>
                <label class="checkbox-option">
                    <input type="checkbox" id="enable-screenreader">
                    <span>Add screen reader alongside visual UI (text-to-speech navigation)</span>
                </label>
            </div>

            <!-- Management mode: Upgrade All button -->
            <div id="management-top-actions" style="display: none;">
                <button id="btn-upgrade-all">Upgrade All</button>
            </div>

            <!-- Management mode: Core upgrade row -->
            <div id="core-upgrade-row" style="display: none;"></div>

            <!-- Management mode: Installed modules with action buttons -->
            <div id="installed-modules" style="display: none;"></div>

            <!-- Management mode: Available (not installed) modules with install buttons -->
            <div id="available-modules" style="display: none;">
                <h3>Available Modules</h3>
                <div id="available-module-list"></div>
            </div>

            <!-- Fresh install mode: module categories with checkboxes -->
            <div id="module-categories" style="display: none;"></div>

            <div class="action-buttons">
                <button id="btn-install">Install</button>
                <button id="btn-back-modules" class="secondary">Back</button>
            </div>

            <!-- Secondary links (shown in management mode) -->
            <div id="secondary-actions" style="display: none;">
                <a href="#" id="link-repair">Repair Installation</a>
                <span class="secondary-divider">|</span>
                <a href="#" id="link-screenreader">Screen Reader</a>
                <span class="secondary-divider">|</span>
                <a href="#" id="link-uninstall">Uninstall</a>
            </div>
        </div>

        <!-- Installing Screen -->
        <div id="screen-installing" class="screen">
            <h1>Installing Move Everything</h1>
            <div class="progress-container">
                <div id="install-progress" class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <p id="install-status">Preparing installation...</p>
            </div>
            <div id="install-checklist"></div>
        </div>

        <!-- Success Screen -->
        <div id="screen-success" class="screen">
            <h1>You're All Set!</h1>
            <div class="success-icon">✓</div>
            <p class="instruction">Move Everything has been successfully installed on your device.</p>
            <div class="info-box" id="success-next-steps">
            </div>
            <button id="btn-back-manage" class="secondary" style="display: none;">Back to Manage</button>
            <button id="btn-start-over" class="secondary" style="display: none;">Start Over</button>
            <button id="btn-done">Done</button>
        </div>

        <!-- Error Screen -->
        <div id="screen-error" class="screen">
            <h1>Installation Failed</h1>
            <div class="error-icon">✗</div>
            <div id="error-message"></div>
            <button id="btn-clean-retry" style="display: none;">Clean Up & Retry</button>
            <button id="btn-retry">Try Again</button>
            <button id="btn-diagnostics" class="secondary">Copy Diagnostics</button>
            <button id="btn-export-logs-error" class="secondary">Export Debug Logs</button>
        </div>
        <!-- Asset Browser Modal -->
        <div id="asset-browser-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="asset-browser-title">Manage Assets</h2>
                    <button id="asset-browser-close" class="modal-close-btn">&times;</button>
                </div>
                <div id="asset-browser-breadcrumb" class="asset-breadcrumb"></div>
                <div class="asset-toolbar">
                    <button id="asset-browser-upload" class="btn-action btn-add-assets">Upload</button>
                    <button id="asset-browser-mkdir" class="btn-action btn-add-assets">New Folder</button>
                </div>
                <div id="asset-browser-dropzone" class="asset-dropzone">
                    <div id="asset-browser-list" class="asset-list"></div>
                    <div id="asset-browser-drop-hint" class="asset-drop-hint" style="display: none;">
                        Drop files here to upload
                    </div>
                </div>
                <div id="asset-browser-status" class="asset-status"></div>
            </div>
        </div>
    </div>
    <footer id="app-footer">
        <a href="#" id="btn-export-logs">Export Debug Logs</a>
    </footer>

    <script>
        // Debug logging
        console.log('[DEBUG] Inline JavaScript is executing');
        console.log('[DEBUG] Window location:', window.location.href);

        document.addEventListener('DOMContentLoaded', () => {
            console.log('[DEBUG] DOM loaded');
        });
    </script>
    <script src="./app.js"></script>
    <script>
        console.log('[DEBUG] After app.js script tag');
    </script>
</body>
</html>
