<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move Everything Installer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Device Discovery Screen -->
        <div id="screen-discovery" class="screen active">
            <h1>Move Everything Installer</h1>
            <div id="discovery-status">
                <div class="spinner"></div>
                <p id="status-text">Searching for your Ableton Move...</p>
            </div>
            <div id="device-list"></div>
            <div class="manual-entry" style="display: none;">
                <p>Can't find move.local? Enter IP address:</p>
                <input type="text" id="manual-ip" placeholder="e.g., 192.168.1.100">
                <button id="btn-manual-connect">Connect</button>
            </div>
        </div>

        <!-- Code Entry Screen -->
        <div id="screen-code-entry" class="screen">
            <h1>Enter Authorization Code</h1>
            <p class="instruction">Check your Ableton Move display for a 6-digit code</p>
            <div class="code-input">
                <input type="text" id="code-digit-1" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-2" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-3" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-4" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-5" maxlength="1" class="code-digit">
                <input type="text" id="code-digit-6" maxlength="1" class="code-digit">
            </div>
            <button id="btn-submit-code" disabled>Continue</button>
            <button id="btn-back-discovery" class="secondary">Back</button>
        </div>

        <!-- Confirm on Device Screen -->
        <div id="screen-confirm" class="screen">
            <h1>Confirm on Device</h1>
            <div class="spinner"></div>
            <p class="instruction">Press the confirm button on your Ableton Move to continue</p>
            <button id="btn-cancel-confirm" class="secondary">Cancel</button>
        </div>

        <!-- Module Selection Screen -->
        <div id="screen-modules" class="screen">
            <h1>Select Modules to Install</h1>
            <p class="instruction">Choose which modules you'd like to install</p>
            <div id="module-categories"></div>
            <div class="action-buttons">
                <button id="btn-install">Install Selected</button>
                <button id="btn-back-code" class="secondary">Back</button>
            </div>
        </div>

        <!-- Installing Screen -->
        <div id="screen-installing" class="screen">
            <h1>Installing Move Everything</h1>
            <div class="progress-container">
                <div id="install-progress" class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <p id="install-status">Preparing installation...</p>
            </div>
            <div id="install-log"></div>
        </div>

        <!-- Success Screen -->
        <div id="screen-success" class="screen">
            <h1>Installation Complete!</h1>
            <div class="success-icon">✓</div>
            <p class="instruction">Move Everything has been successfully installed on your device</p>
            <div class="credentials-box">
                <h3>SSH Access Details</h3>
                <p><strong>IP Address:</strong> <span id="device-ip"></span></p>
                <p><strong>Username:</strong> root</p>
                <p><strong>Password:</strong> <span id="ssh-password"></span></p>
                <button id="btn-copy-credentials">Copy to Clipboard</button>
            </div>
            <button id="btn-done">Done</button>
        </div>

        <!-- Error Screen -->
        <div id="screen-error" class="screen">
            <h1>Installation Failed</h1>
            <div class="error-icon">✗</div>
            <div id="error-message"></div>
            <button id="btn-retry">Try Again</button>
            <button id="btn-diagnostics" class="secondary">Copy Diagnostics</button>
        </div>
    </div>

    <!-- Test: Change text immediately to verify JS is running -->
    <script>
        document.getElementById('status-text').textContent = 'JavaScript is running!';
    </script>

    <script>
        // Use Tauri's internal IPC directly (works in packaged apps)
        window.__TAURI__ = {
            invoke: async (cmd, args) => {
                return window.__TAURI_INTERNALS__.invoke(cmd, args);
            }
        };
    </script>
    <script src="app.js"></script>
</body>
</html>
